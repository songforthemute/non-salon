---
import Layout from "@/layouts/Layout.astro";
import fs from "node:fs";
import path from "node:path";

interface Post {
	id: string;
	title: string;
	slug: string;
	description: string | null;
	tags: string[];
	lastEditedTime: string;
}

const postsPath = path.join(process.cwd(), "data", "posts.json");
const publishedDatesPath = path.join(process.cwd(), "data", "published-dates.json");

let posts: Post[] = [];
let publishedDates: Record<string, string> = {};

if (fs.existsSync(postsPath)) {
	posts = JSON.parse(fs.readFileSync(postsPath, "utf-8"));
}

if (fs.existsSync(publishedDatesPath)) {
	publishedDates = JSON.parse(fs.readFileSync(publishedDatesPath, "utf-8"));
}

// 출판일 기준 내림차순 정렬
posts.sort((a, b) => {
	const dateA = publishedDates[a.slug] || a.lastEditedTime;
	const dateB = publishedDates[b.slug] || b.lastEditedTime;
	return new Date(dateB).getTime() - new Date(dateA).getTime();
});

function formatDate(dateStr: string): string {
	return new Date(dateStr).toLocaleDateString("ko-KR", {
		year: "numeric",
		month: "long",
		day: "numeric",
	});
}
---

<Layout title="Home">
	<h1>whitespace</h1>
	{posts.length === 0 ? (
		<p>아직 글이 없습니다.</p>
	) : (
		<ul>
			{posts.map((post) => (
				<li>
					<a href={`/posts/${post.slug}`}>{post.title}</a>
					<time datetime={publishedDates[post.slug] || post.lastEditedTime}>
						{formatDate(publishedDates[post.slug] || post.lastEditedTime)}
					</time>
					{post.description && <p>{post.description}</p>}
				</li>
			))}
		</ul>
	)}
</Layout>

<style>
	ul {
		list-style: none;
		padding: 0;
	}
	li {
		margin-bottom: 2rem;
	}
	li a {
		font-size: 1.25rem;
		font-weight: 600;
	}
	li time {
		display: block;
		color: #666;
		font-size: 0.875rem;
		margin-top: 0.25rem;
	}
	li p {
		margin-top: 0.5rem;
		color: #444;
	}
</style>
