---
import Layout from "@/layouts/Layout.astro";
import { blocksToHtml } from "@/lib/block-to-html";
import { formatDate } from "@/lib/format";
import { getPostsByType, getPublishedDate, loadPublishedDates } from "@/lib/posts";
import type { Post } from "@/types";

export function getStaticPaths() {
	const posts = getPostsByType("publication");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props as { post: Post };
const publishedDates = loadPublishedDates();
const publishedDate = getPublishedDate(post, publishedDates);
const content = blocksToHtml(post.blocks as Parameters<typeof blocksToHtml>[0]);
---

<Layout title={post.title} description={post.description || undefined}>
	<article>
		<header>
			<h1>{post.title}</h1>
			<time datetime={publishedDate}>{formatDate(publishedDate)}</time>
			{post.tags.length > 0 && <p class="tags">{post.tags.join(", ")}</p>}
		</header>
		<div class="content" data-pagefind-body set:html={content} />
	</article>
</Layout>

<style>
	article header {
		margin-bottom: 2rem;
	}
	article h1 {
		margin-bottom: 0.5rem;
	}
	article time {
		color: #666;
	}
	.tags {
		margin-top: 0.5rem;
		font-size: 0.875rem;
		color: #666;
	}
</style>
